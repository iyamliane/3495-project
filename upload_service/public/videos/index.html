<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Videos</title>
    <style>
      body{font-family:Inter,system-ui,Arial;background:#ffffff;color:#111827;margin:0;padding:28px}
      .wrap{max-width:1100px;margin:0 auto}
      h1{margin:0 0 8px}
      .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
      .card{background:#fff;border:1px solid rgba(0,0,0,0.06);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,0.04)}
      video{width:100%;height:160px;background:#000;border-radius:6px}
      .meta{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
      .small{color:#6b7280;font-size:13px}
      .play{background:#dc2626;padding:8px 10px;border-radius:8px;color:#fff;border:none}
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1>Uploaded Videos</h1>
      <p class="small">Browse and play videos uploaded to the service.</p>
      <div id="grid" class="grid"></div>
    </div>
    <script>
      async function load(){
        const token = localStorage.getItem('access_token');
        const headers = token ? { Authorization: 'Bearer ' + token } : {};
        const res = await fetch('http://localhost:4000/videos', { headers });
        if(!res.ok){document.getElementById('grid').textContent='Failed to load videos';return}
        const data = await res.json();
        const grid = document.getElementById('grid');
        grid.innerHTML='';
        data.forEach(v=>{
          const div = document.createElement('div'); div.className='card';
          const vid = document.createElement('video'); vid.controls=true; vid.src = `http://localhost:4000/stream/${v.path}`;
          const meta = document.createElement('div'); meta.className='meta';
          const left = document.createElement('div'); left.innerHTML = `<div style="font-weight:600">${v.filename}</div><div class="small">uploaded by ${v.username}</div>`;
          const right = document.createElement('div'); right.innerHTML = `<button class='play' onclick="vid.play()">Play</button>`;
          meta.appendChild(left); meta.appendChild(right);
          div.appendChild(vid); div.appendChild(meta); grid.appendChild(div);
        })
      }
      load().catch(e=>document.getElementById('grid').textContent='Load error: '+e.message)
    </script>
  </body>
</html>
